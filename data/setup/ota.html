<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OTA Update</title>
  <link rel="icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/setup/setup.css" />
</head>
<body data-page="ota">
  <main>
    <header>
      <h1>OTA & Firmware Update</h1>
      <p>Update your device firmware manually or via GitHub releases. Use either method below.</p>
      <div class="fw-version-banner">Installed version: <span id="fw-version">...</span></div>
    </header>

    <section>
      <h2>Manual OTA Upload</h2>
      <form id="ota-form">
        <div class="form-grid">
          <label>
            Firmware file
            <input type="file" id="ota-file" accept=".bin" required />
          </label>
        </div>
        <progress id="ota-progress" value="0" max="100" hidden></progress>
        <div class="status" id="ota-status" hidden></div>
        <div class="link-row">
          <button type="submit">Start update</button>
          <a href="/setup/wifi.html" class="button-link secondary">Back to Wi-Fi</a>
          <a href="/service/main.html" class="button-link secondary">Service home</a>
        </div>
      </form>
    </section>

    <section id="fw-auto-update-section">
      <h2>Firmware auto-update</h2>
      <form id="fw-auto-update-form">
        <div class="form-grid">
          <label>
            GitHub repo (owner/repo)
            <input type="text" id="fw-git-repo" placeholder="user/project" autocomplete="off" />
          </label>
          <label>
            Board type
            <select id="fw-board-type">
              <option value="esp32dev">ESP32 DevKit (esp32dev)</option>
              <option value="esp32wroom">ESP32 WROOM (esp32wroom)</option>
              <option value="esp32wrover">ESP32 WROVER (esp32wrover)</option>
              <option value="esp32s3n16r8_psram">ESP32-S3 n16r8 with PSRAM</option>
              <option value="esp32s3n16r8_nopsram">ESP32-S3 n16r8 NO PSRAM</option>
            </select>
          </label>
        </div>
        <div class="status" id="fw-auto-update-status" hidden></div>
        <div class="fw-update-progress-row">
          <progress id="fw-auto-update-progress" value="0" max="100" hidden></progress>
          <div id="fw-auto-update-warning" class="hint" style="color:#fbbf24;display:none;">Do not power off or refresh the page during update! The device will reboot automatically.</div>
        </div>
        <div class="link-row">
          <button type="button" id="fw-save-config">Save</button>
          <button type="button" id="fw-check-update">Check for update</button>
          <button type="button" id="fw-do-update" disabled>Update now</button>
        </div>
        <p class="hint">Device will check for new releases in the specified repo once a day automatically. You can also check and update manually here.</p>
      </form>
    </section>
  </main>
  <script src="/setup/setup.js" defer></script>
</body>
</html>
